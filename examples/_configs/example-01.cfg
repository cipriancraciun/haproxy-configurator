
global

    #---- Identity
    node 'haproxy.example.com'
    description '[]'

    #---- Daemon
    nbthread 1
    ulimit-n 65536
    user 'haproxy'
    group 'haproxy'
    pidfile '/run/haproxy.pid'

    #---- State
    server-state-base '/run/haproxy-states'
    server-state-file '/run/haproxy.state'

    #---- Connections
    maxconn 8192
    maxconnrate 512
    maxsessrate 2048
    maxsslconn 4096
    maxsslrate 256
    maxpipes 4096

    #---- Checks
    max-spread-checks 6
    spread-checks 25

    #---- HTTP
    tune.http.logurilen 4096
    tune.http.maxhdr 64

    #---- HTTP/2
    tune.h2.header-table-size 16384
    tune.h2.initial-window-size 131072
    tune.h2.max-concurrent-streams 128

    #---- Compression
    maxcomprate 0
    maxcompcpuusage 25
    maxzlibmem 128
    tune.comp.maxlevel 9

    #---- Buffers
    tune.bufsize 131072
    tune.buffers.limit 4096
    tune.buffers.reserve 16
    tune.maxrewrite 16384

    #---- TLS default configuration
    ssl-default-bind-ciphers 'ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES128-GCM-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA'
    ssl-default-bind-ciphersuites 'TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256'
    ssl-default-bind-curves 'X25519'
    ssl-default-bind-options no-tlsv11 no-tlsv10 no-sslv3 no-tls-tickets
    ssl-default-server-ciphers 'ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES128-GCM-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA'
    ssl-default-server-ciphersuites 'TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256'
    ssl-default-server-curves 'X25519'
    ssl-default-server-options no-tlsv11 no-tlsv10 no-sslv3 no-tls-tickets
    ssl-server-verify required
    ssl-skip-self-issued-ca
    ssl-dh-param-file '/etc/haproxy/tls/dh-params.pem'

    #---- TLS advanced configuration
    tune.ssl.default-dh-param 2048
    tune.ssl.maxrecord 16384
    tune.ssl.cachesize 131072
    tune.ssl.lifetime 3600s

    #---- Logging
    log '/dev/log' len 65535 format 'rfc5424' daemon 'info' 'err'
    log-send-hostname 'haproxy.example.com'
    log-tag 'haproxy'
    quiet

    #---- Statistics
    stats socket 'unix@/run/haproxy.sock' user 'haproxy' group 'haproxy' mode 0600 level admin
    stats maxconn 4
    stats timeout 60s








defaults

    #---- Protocol
    mode tcp
    disabled

    #---- Connections
    maxconn 4096
    backlog 1024
    rate-limit sessions 16384
    balance roundrobin
    retries 4

    #---- Connections TCP-Keep-Alive
    option clitcpka
    option srvtcpka

    #---- Connections splicing
    option splice-request
    option splice-response
    no option splice-auto

    #---- Timeouts
    timeout server 60s
    timeout server-fin 60s
    timeout client 12s
    timeout client-fin 12s
    timeout tunnel 120s
    timeout connect 6s
    timeout queue 30s
    timeout check 6s
    timeout tarpit 60s

    #---- Servers
    fullconn 32
    default-server minconn 8
    default-server maxconn 32
    default-server maxqueue 128
    default-server inter 60s
    default-server fastinter 2s
    default-server downinter 20s
    default-server rise 8
    default-server fall 4
    default-server on-error fastinter
    default-server error-limit 4

    #---- HTTP
    http-reuse safe
    http-check disable-on-404
    http-check send-state
    option http-keep-alive
    timeout http-request 24s
    timeout http-keep-alive 60s
    unique-id-format "%[req.hdr(X-HA-Request-Id)]"

    #---- HTTP compression
    compression algo gzip
    compression type 'text/html' 'text/css' 'application/javascript' 'text/javascript' 'application/xml' 'text/xml' 'application/xhtml+xml' 'application/rss+xml' 'application/atom+xml' 'application/json' 'text/json' 'text/plain' 'text/csv' 'text/tab-separated-values' 'image/svg+xml' 'image/vnd.microsoft.icon' 'image/x-icon' 'font/collection' 'font/otf' 'application/font-otf' 'application/x-font-otf' 'application/x-font-opentype' 'font/ttf' 'application/font-ttf' 'application/x-font-ttf' 'application/x-font-truetype' 'font/sfnt' 'application/font-sfnt' 'application/x-font-sfnt' 'font/woff' 'application/font-woff' 'application/x-font-woff' 'font/woff2' 'application/font-woff2' 'application/x-font-woff2' 'font/eot' 'application/font-eot' 'application/x-font-eot' 'application/vnd.ms-fontobject'

    #---- Logging
    log global
    option log-separate-errors
    option log-health-checks
    no option checkcache
    no option dontlognull

    #---- Stats
    option contstats
    option socket-stats

    #---- Error pages
    errorfile 200 '/etc/haproxy/errors/http/monitor.http'
    errorfile 400 '/etc/haproxy/errors/http/400.http'
    errorfile 401 '/etc/haproxy/errors/http/401.http'
    errorfile 403 '/etc/haproxy/errors/http/403.http'
    errorfile 404 '/etc/haproxy/errors/http/404.http'
    errorfile 405 '/etc/haproxy/errors/http/405.http'
    errorfile 408 '/etc/haproxy/errors/http/408.http'
    errorfile 410 '/etc/haproxy/errors/http/410.http'
    errorfile 429 '/etc/haproxy/errors/http/429.http'
    errorfile 500 '/etc/haproxy/errors/http/500.http'
    errorfile 501 '/etc/haproxy/errors/http/501.http'
    errorfile 502 '/etc/haproxy/errors/http/502.http'
    errorfile 503 '/etc/haproxy/errors/http/503.http'
    errorfile 504 '/etc/haproxy/errors/http/504.http'

    #---- State
    load-server-state-from-file global








frontend 'http'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    maxconn 4096
    backlog 1024
    option http-keep-alive

    #---- Compression
    compression algo gzip
    compression type 'text/html' 'text/css' 'application/javascript' 'text/javascript' 'application/xml' 'text/xml' 'application/xhtml+xml' 'application/rss+xml' 'application/atom+xml' 'application/json' 'text/json' 'text/plain' 'text/csv' 'text/tab-separated-values' 'image/svg+xml' 'image/vnd.microsoft.icon' 'image/x-icon' 'font/collection' 'font/otf' 'application/font-otf' 'application/x-font-otf' 'application/x-font-opentype' 'font/ttf' 'application/font-ttf' 'application/x-font-ttf' 'application/x-font-truetype' 'font/sfnt' 'application/font-sfnt' 'application/x-font-sfnt' 'font/woff' 'application/font-woff' 'application/x-font-woff' 'font/woff2' 'application/font-woff2' 'application/x-font-woff2' 'font/eot' 'application/font-eot' 'application/x-font-eot' 'application/vnd.ms-fontobject'
    compression offload

    #---- Bind
    bind 'ipv4@0.0.0.0:80' defer-accept mss 1400 maxconn 4096 backlog 1024

    #---- ACL
    acl acl-15b3478fcd00d46bfa2a3c43dfba92d7 path -m beg -- '/admin/'
    acl acl-660a5efcd163a9d4ba7e48db099f3a20 path -m str eq -- '/__/heartbeat-haproxy'
    acl acl-61fff4800014561ce8fcec11d8191fe0 query -m found
    acl acl-0294ec42d396fdc162af2e797e1c2fbb req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'admin.example.com'
    acl acl-4af98aab9baf82615c8b5339a88e93d7 req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'admin.example.com'
    acl acl-4a915d6c0eec5d2bfc2e2f87c12a6dca req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'blog.example.com'
    acl acl-d1d5164097985b8997faee890a444f34 req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'example.com'
    acl acl-4ba4267a9e1d1296c9792e0c54286c95 req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'media.example.com'
    acl acl-0294ec42d396fdc162af2e797e1c2fbb req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'www.example.com'
    acl acl-bd17590b8d0f8ec47af0d1445cb8cb1a req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.') -m str -i eq -- 'www.example.com'
    acl acl-ec8d3469dfa9bd7a78ae9d96b66b64df ssl_fc -m bool
    acl acl-7af25b1c4b2d773ab0a34441a029e3c1 ssl_fc,not -m bool
    acl acl-8bac66a80ab5d7afb73f8e15e689e3b7 var('txn.http_debugging_enabled'),bool -m bool
    acl acl-3a706eb6d2520c39add4c7d9913cfe80 var('txn.http_debugging_excluded'),bool -m bool

    #---- Stick tables
    stick-table type ipv6 size 1048576 expire 3600s store conn_cur,conn_cnt,conn_rate(60s),sess_cnt,sess_rate(60s),http_req_cnt,http_req_rate(60s),http_err_cnt,http_err_rate(60s),bytes_in_cnt,bytes_in_rate(60s),bytes_out_cnt,bytes_out_rate(60s)
    http-request track-sc0 src

    #---- HTTP Request Rules
    http-request deny deny_status 200 if acl-660a5efcd163a9d4ba7e48db099f3a20
    http-request set-header "X-Forwarded-Host" "%[req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.')]"
    http-request set-header "X-Forwarded-For" "%ci"
    http-request set-header "X-Forwarded-Proto" "http" if acl-7af25b1c4b2d773ab0a34441a029e3c1
    http-request set-header "X-Forwarded-Proto" "https" if acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-request set-header "X-Forwarded-Port" "80" if acl-7af25b1c4b2d773ab0a34441a029e3c1
    http-request set-header "X-Forwarded-Port" "443" if acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-request set-header "X-Forwarded-Server-Ip" "%fi"
    http-request set-header "X-Forwarded-Server-Port" "%fp"
    http-request set-var-fmt(txn.logging_http_action) "%[method,upper]://%[req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.')]%[path]" if !acl-61fff4800014561ce8fcec11d8191fe0
    http-request set-var-fmt(txn.logging_http_action) "%[method,upper]://%[req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.')]%[path]?%[query]" if acl-61fff4800014561ce8fcec11d8191fe0
    http-request set-var(txn.logging_http_method) method,upper
    http-request set-var(txn.logging_http_host) req.fhdr('Host',-1),host_only,ltrim('.'),rtrim('.')
    http-request set-var(txn.logging_http_path) path
    http-request set-var(txn.logging_http_query) query
    http-request set-var(txn.logging_http_forwarded_host) req.hdr('X-Forwarded-Host',1)
    http-request set-var(txn.logging_http_forwarded_for) req.hdr('X-Forwarded-For',1)
    http-request set-var(txn.logging_http_forwarded_proto) req.hdr('X-Forwarded-Proto',1)
    http-request set-var(txn.logging_http_request) req.fhdr('X-HA-Request-Id',-1)
    http-request set-var(txn.logging_http_session) req.fhdr('X-HA-Session-Id',-1)
    http-request set-var(txn.logging_http_agent) req.fhdr('User-Agent',-1)
    http-request set-var(txn.logging_http_referrer) req.fhdr('Referer',-1)
    http-request capture req.fhdr('Host',-1),base64 id 0
    http-request capture req.fhdr('X-Forwarded-Host',-1),base64 id 1
    http-request capture req.fhdr('X-Forwarded-For',-1),base64 id 2
    http-request capture req.fhdr('X-Forwarded-Proto',-1),base64 id 3
    http-request capture req.fhdr('X-Forwarded-Port',-1),base64 id 4
    http-request capture req.fhdr('X-HA-Request-Id',-1),base64 id 5
    http-request capture req.fhdr('X-HA-Session-Id',-1),base64 id 6
    http-request capture req.fhdr('User-Agent',-1),base64 id 7
    http-request capture req.fhdr('Referer',-1),base64 id 8
    http-request capture req.fhdr('Accept-Encoding',-1),base64 id 9
    http-request capture req.fhdr('Accept-Language',-1),base64 id 10
    http-request capture req.fhdr('Accept-Charset',-1),base64 id 11
    http-request capture req.fhdr('Cache-Control',-1),base64 id 12
    http-request capture req.fhdr('If-None-Match',-1),base64 id 13
    http-request capture req.fhdr('If-Match',-1),base64 id 14
    http-request capture req.fhdr('If-Modified-Since',-1),base64 id 15
    http-request capture req.fhdr('If-Unmodified-Since',-1),base64 id 16
    http-request capture req.fhdr('Pragma',-1),base64 id 17
    http-request capture req.fhdr('Cookie',1),base64 id 18
    http-request capture req.fhdr('Cookie',2),base64 id 19
    http-request capture req.fhdr('Cookie',3),base64 id 20
    http-request capture req.fhdr('Cookie',4),base64 id 21
    http-request set-header "X-HA-HTTP-Action" "%[var('txn.logging_http_action')]" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-request set-header "X-HA-Timestamp" "%[date(),http_date()]" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-request add-header "X-HA-Frontend" "%f" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-request add-header "X-HA-Backend" "%b" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-request redirect scheme https code 307 if acl-7af25b1c4b2d773ab0a34441a029e3c1
    http-request redirect prefix "https://www.example.com" code 307 if acl-d1d5164097985b8997faee890a444f34 acl-7af25b1c4b2d773ab0a34441a029e3c1
    http-request redirect prefix "https://www.example.com" code 307 if acl-d1d5164097985b8997faee890a444f34 acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-request redirect prefix "https://www.example.com/blog" code 307 if acl-4a915d6c0eec5d2bfc2e2f87c12a6dca
    http-request redirect prefix "https://admin.example.com" code 307 if acl-bd17590b8d0f8ec47af0d1445cb8cb1a acl-15b3478fcd00d46bfa2a3c43dfba92d7

    #---- HTTP Response Rules
    http-response set-var(txn.logging_http_location) res.fhdr('Location',-1)
    http-response set-var(txn.logging_http_content_type) res.fhdr('Content-Type',-1)
    http-response set-var(txn.logging_http_content_encoding) res.fhdr('Content-Encoding',-1)
    http-response set-var(txn.logging_http_content_length) res.fhdr('Content-Length',-1)
    http-response set-var(txn.logging_http_cache_control) res.fhdr('Cache-Control',-1)
    http-response set-var(txn.logging_http_cache_etag) res.fhdr('ETag',-1)
    http-response capture res.fhdr('Location',-1),base64 id 0
    http-response capture res.fhdr('Content-Type',-1),base64 id 1
    http-response capture res.fhdr('Content-Encoding',-1),base64 id 2
    http-response capture res.fhdr('Content-Length',-1),base64 id 3
    http-response capture res.fhdr('Content-Disposition',-1),base64 id 4
    http-response capture res.fhdr('Cache-Control',-1),base64 id 5
    http-response capture res.fhdr('Last-Modified',-1),base64 id 6
    http-response capture res.fhdr('Expires',-1),base64 id 7
    http-response capture res.fhdr('Date',-1),base64 id 8
    http-response capture res.fhdr('ETag',-1),base64 id 9
    http-response capture res.fhdr('Vary',-1),base64 id 10
    http-response capture res.fhdr('Age',-1),base64 id 11
    http-response capture res.fhdr('Pragma',-1),base64 id 12
    http-response capture res.fhdr('Set-Cookie',1),base64 id 13
    http-response capture res.fhdr('Set-Cookie',2),base64 id 14
    http-response capture res.fhdr('Set-Cookie',3),base64 id 15
    http-response capture res.fhdr('Set-Cookie',4),base64 id 16
    http-response set-header "X-HA-HTTP-Action" "%[var('txn.logging_http_action')]" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-response set-header "X-HA-Timestamp" "%[date(),http_date()]" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-response add-header "X-HA-Frontend" "%f" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80
    http-response add-header "X-HA-Backend" "%b" if acl-8bac66a80ab5d7afb73f8e15e689e3b7 !acl-3a706eb6d2520c39add4c7d9913cfe80

    #---- Routes
    use_backend http-www if acl-bd17590b8d0f8ec47af0d1445cb8cb1a
    use_backend http-admin if acl-4af98aab9baf82615c8b5339a88e93d7
    use_backend http-static if acl-0294ec42d396fdc162af2e797e1c2fbb /assets/ /public/
    use_backend http-media if acl-4ba4267a9e1d1296c9792e0c54286c95
    use_backend http-fallback

    #---- Monitoring
    monitor-uri '/__/heartbeat-proxy'
    monitor fail if FALSE

    #---- Stats
    stats enable
    stats uri '/__/haproxy/beb36ad8a85568b7e89e314b2e03244f'
    stats realm 'haproxy@haproxy.example.com'
    stats show-node 'haproxy.example.com'
    stats show-desc '[]'
    stats show-legends
    stats refresh 6s

    #---- Logging
    option httplog
    log-format "{  \"s\":\"20230324:01\",  \"ss\":\"default\",  \"t\":%Ts.%ms,  \"f_id\":\"%{Q}f\",  \"b_id\":\"%{Q}b\",  \"s_id\":\"%{Q}s\",  \"h_v\":\"%{Q}HV\",  \"h_vm\":%[fc_http_major],  \"h_s\":%ST,  \"h_m0\":\"%{Q}HM\",  \"h_u0\":\"%{Q}HU\",  \"h_p0\":\"%{Q}HPO\",  \"h_q0\":\"%{Q}HQ\",  \"h_i0\":\"%{Q}ID\",  \"h_t0\":\"%{Q}trg\",  \"h_h\":\"%[var(txn.logging_http_host),json()]\",  \"h_m\":\"%[var(txn.logging_http_method),json()]\",  \"h_p\":\"%[var(txn.logging_http_path),json()]\",  \"h_q\":\"%[var(txn.logging_http_query),json()]\",  \"h_r_i\":\"%[var(txn.logging_http_request),json()]\",  \"h_r_s\":\"%[var(txn.logging_http_session),json()]\",  \"h_f_h\":\"%[var(txn.logging_http_forwarded_host),json()]\",  \"h_f_f\":\"%[var(txn.logging_http_forwarded_for),json()]\",  \"h_f_p\":\"%[var(txn.logging_http_forwarded_proto),json()]\",  \"h_h_a\":\"%[var(txn.logging_http_agent),json()]\",  \"h_h_r\":\"%[var(txn.logging_http_referrer),json()]\",  \"h_h_l\":\"%[var(txn.logging_http_location),json()]\",  \"h_h_ct\":\"%[var(txn.logging_http_content_type),json()]\",  \"h_h_ce\":\"%[var(txn.logging_http_content_encoding),json()]\",  \"h_h_cl\":\"%[var(txn.logging_http_content_length),json()]\",  \"h_h_cc\":\"%[var(txn.logging_http_cache_control),json()]\",  \"h_h_cv\":\"%[var(txn.logging_http_cache_etag),json()]\",  \"h_i_hdr\":\"%{Q}hrl\",  \"h_o_hdr\":\"%{Q}hsl\",  \"h_i_ck\":\"%{Q}CC\",  \"h_o_ck\":\"%{Q}CS\",  \"h_o_comp\":[\"%[res.comp]\",\"%[res.comp_algo]\"],  \"c_sck\":[\"%{Q}ci\",\"%{Q}cp\"],  \"f_sck\":[\"%{Q}fi\",\"%{Q}fp\"],  \"b_sck\":[\"%{Q}bi\",\"%{Q}bp\"],  \"s_sck\":[\"%{Q}si\",\"%{Q}sp\"],  \"ts\":\"%{Q}tsc\",  \"f_err\":\"%[fc_err]\",  \"b_err\":\"%[bc_err]\",  \"i_sz\":%U,  \"o_sz\":%B,  \"w\":[%Tt,%Tq,%Ta],  \"w_x\":[%Th,%Ti,%TR,%Tw,%Tc,%Tr,%Td],  \"cnt\":[%ac,%fc,%bc,%bq,%sc,%sq,%rc,%rt,%lc],  \"ssl\":[\"%{Q}sslv\",\"%{Q}sslc\"],  \"ssl_f\":[\"%[ssl_fc,json()]\",\"%[ssl_fc_err,json()]\",\"%[ssl_fc_protocol,json()]\",\"%[ssl_fc_cipher,json()]\",\"%[ssl_fc_unique_id,hex()]\",\"%[ssl_fc_session_id,hex()]\",\"%[ssl_fc_is_resumed,json()]\",\"%[ssl_fc_alpn,json()]\",\"%[ssl_fc_npn,json()]\",\"%[ssl_fc_sni,json()]\"],  \"ssl_b\":[\"%[ssl_bc,json()]\",\"%[ssl_bc_err,json()]\",\"%[ssl_bc_protocol,json()]\",\"%[ssl_bc_cipher,json()]\",\"%[ssl_bc_unique_id,hex()]\",\"%[ssl_bc_session_id,hex()]\",\"%[ssl_bc_is_resumed,json()]\",\"%[ssl_bc_alpn,json()]\",\"%[ssl_bc_npn,json()]\"],  \"ssl_xf\":[\"%[ssl_fc,json()]\",\"%[ssl_f_version,json()]\",\"%[ssl_f_key_alg,json()]\",\"%[ssl_f_sig_alg,json()]\",\"%[ssl_f_sha1,hex]\",\"%[ssl_f_s_dn,json()]\",\"%[ssl_f_i_dn,json()]\"],  \"ssl_xc\":[\"%[ssl_c_used,json()]\",\"%[ssl_c_version,json()]\",\"%[ssl_c_key_alg,json()]\",\"%[ssl_c_sig_alg,json()]\",\"%[ssl_c_sha1,hex]\",\"%[ssl_c_s_dn,json()]\",\"%[ssl_c_i_dn,json()]\",\"%[ssl_c_verify,json()]\",\"%[ssl_c_err,json()]\",\"%[ssl_c_ca_err,json()]\",\"%[ssl_c_ca_err_depth,json()]\"],  \"stick\":[\"%[sc0_conn_cur()]\",\"%[sc0_conn_cnt()]\",\"%[sc0_conn_rate()]\",\"%[sc0_sess_cnt()]\",\"%[sc0_sess_rate()]\",\"%[sc0_http_req_cnt()]\",\"%[sc0_http_req_rate()]\",\"%[sc0_http_err_cnt()]\",\"%[sc0_http_err_rate()]\",\"%[sc0_kbytes_in()]\",\"%[sc0_bytes_in_rate()]\",\"%[sc0_kbytes_out()]\",\"%[sc0_bytes_out_rate()]\"]  }"

    #---- Captures for requests
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024

    #---- Captures for responses
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024








backend 'http-www'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none
    option abortonclose

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- Servers
    default-server init-addr none

    #---- ACL
    acl acl-7a42bfe535dc7a450d6cfc0c0132d75f method,upper -m str -i eq -- 'GET'
    acl acl-7a42bfe535dc7a450d6cfc0c0132d75f method,upper -m str -i eq -- 'HEAD'
    acl acl-7a42bfe535dc7a450d6cfc0c0132d75f method,upper -m str -i eq -- 'OPTIONS'
    acl acl-8efd2993b14d7316ac2f903fed7bb3ac res.fhdr_cnt('X-HA-Hardened'),bool,not -m bool
    acl acl-ec8d3469dfa9bd7a78ae9d96b66b64df ssl_fc -m bool
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 200
    acl acl-2e34a246b1b4365031ce44deaefdf3c7 status -m int eq -- 200
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 200
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 201
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 201
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 202
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 202
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 204
    acl acl-2e34a246b1b4365031ce44deaefdf3c7 status -m int eq -- 204
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 204
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 206
    acl acl-2e34a246b1b4365031ce44deaefdf3c7 status -m int eq -- 206
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 301
    acl acl-2e34a246b1b4365031ce44deaefdf3c7 status -m int eq -- 301
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 302
    acl acl-2e34a246b1b4365031ce44deaefdf3c7 status -m int eq -- 302
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 303
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 303
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 304
    acl acl-2e34a246b1b4365031ce44deaefdf3c7 status -m int eq -- 304
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 307
    acl acl-23c70cf6c94aef7a5b7f992e8da7fa3e status -m int eq -- 308
    acl acl-c7420d78700b3e8fa37945e4ada241f4 var('txn.http_drop_cookies_enabled'),bool -m bool
    acl acl-d83a8a9567885f6f8343bdae424af3f6 var('txn.http_drop_cookies_excluded'),bool -m bool
    acl acl-a13dd1b9f0ecb442f2ec295ad1db0367 var('txn.http_force_caching_enabled'),bool -m bool
    acl acl-eedccd702a27b10d2ae38b601f3dad45 var('txn.http_force_caching_excluded'),bool -m bool
    acl acl-766136fb89c18a529ae828035871887d var('txn.http_harden_enabled'),bool -m bool
    acl acl-987ae99ba6da32008839067c993ad497 var('txn.http_harden_excluded'),bool -m bool
    acl acl-f8de46cff6c1207cdcc8beacca736001 var('txn.http_ranges_allowed'),bool -m bool
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'GET'
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'HEAD'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'POST'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-7a42bfe535dc7a450d6cfc0c0132d75f acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "User-Agent" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Referer" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Encoding" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Language" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Charset" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Authorization" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001
    http-request del-header "If-Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001
    http-request set-var(txn.http_drop_cookies_enabled) bool(true)
    http-request del-header "Cookie" if acl-c7420d78700b3e8fa37945e4ada241f4 !acl-d83a8a9567885f6f8343bdae424af3f6
    http-request set-var(txn.http_force_caching_enabled) bool(true)
    http-request set-var(txn.http_drop_cookies_enabled) bool(true)
    http-request del-header "Cookie" if acl-c7420d78700b3e8fa37945e4ada241f4 !acl-d83a8a9567885f6f8343bdae424af3f6
    http-request set-var(txn.http_force_caching_enabled) bool(true)
    http-request set-var(txn.http_drop_cookies_enabled) bool(true)
    http-request del-header "Cookie" if acl-c7420d78700b3e8fa37945e4ada241f4 !acl-d83a8a9567885f6f8343bdae424af3f6
    http-request set-var(txn.http_force_caching_enabled) bool(true)

    #---- HTTP Response Rules
    http-response deny if !acl-23c70cf6c94aef7a5b7f992e8da7fa3e acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-a5ce4c4d95c7c2b129ce65034af2ce3b !acl-2e34a246b1b4365031ce44deaefdf3c7 acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-129daa7ff8911a10a9f9372f07d30810 !acl-5d60910ffcf3e7a6e2ce9526542fda3a acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Frame-Options" "SAMEORIGIN" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Feature-Policy" "accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; camera 'none'; display-capture 'none'; document-domain 'none'; encrypted-media 'none'; fullscreen 'none'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-get 'none'; sync-xhr 'none'; usb 'none'; xr-spatial-tracking 'none'" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Cross-Origin-Opener-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Resource-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Embedder-Policy" "unsafe-none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Via" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Server" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "X-Powered-By" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Accept-Ranges" "none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac !acl-f8de46cff6c1207cdcc8beacca736001
    http-response set-header "Strict-Transport-Security" "max-age=2419200" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response del-header "Set-Cookie" if acl-c7420d78700b3e8fa37945e4ada241f4 !acl-d83a8a9567885f6f8343bdae424af3f6
    http-response set-header "Cache-Control" "public, immutable, max-age=3600" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Last-Modified" "%[date(-3600),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Expires" "%[date(3600),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Date" "%[date(),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Age" "0" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Pragma" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "ETag" "\"%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]\"" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Set-Cookie" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Set-Cookie" if acl-c7420d78700b3e8fa37945e4ada241f4 !acl-d83a8a9567885f6f8343bdae424af3f6
    http-response set-header "Cache-Control" "public, immutable, max-age=3600" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Last-Modified" "%[date(-3600),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Expires" "%[date(3600),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Date" "%[date(),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Age" "0" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Pragma" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "ETag" "\"%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]\"" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Set-Cookie" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Set-Cookie" if acl-c7420d78700b3e8fa37945e4ada241f4 !acl-d83a8a9567885f6f8343bdae424af3f6
    http-response set-header "Cache-Control" "public, immutable, max-age=3600" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Last-Modified" "%[date(-3600),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Expires" "%[date(3600),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Date" "%[date(),http_date()]" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "Age" "0" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Pragma" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response set-header "ETag" "\"%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]\"" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45
    http-response del-header "Set-Cookie" if acl-a13dd1b9f0ecb442f2ec295ad1db0367 !acl-eedccd702a27b10d2ae38b601f3dad45

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9090' check observe layer7




backend 'http-admin'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none
    option abortonclose

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- Servers
    default-server init-addr none

    #---- ACL
    acl acl-9e7f02c411b61b73a994c13f5425ff34 http_auth('operators'),bool -m bool
    acl acl-e8d600e60373785655b4658e9892e40e method,upper -m str -i eq -- 'GET'
    acl acl-8efd2993b14d7316ac2f903fed7bb3ac res.fhdr_cnt('X-HA-Hardened'),bool,not -m bool
    acl acl-ec8d3469dfa9bd7a78ae9d96b66b64df ssl_fc -m bool
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 200
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 200
    acl acl-f60b83decee1e372ae573669776d5e7a status -m int eq -- 200
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 201
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 202
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 204
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 204
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 301
    acl acl-f60b83decee1e372ae573669776d5e7a status -m int eq -- 301
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 302
    acl acl-f60b83decee1e372ae573669776d5e7a status -m int eq -- 302
    acl acl-5d60910ffcf3e7a6e2ce9526542fda3a status -m int eq -- 303
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 303
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 304
    acl acl-f60b83decee1e372ae573669776d5e7a status -m int eq -- 304
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 307
    acl acl-a826330dc6dcbe55c697edbaf2545179 status -m int eq -- 308
    acl acl-766136fb89c18a529ae828035871887d var('txn.http_harden_enabled'),bool -m bool
    acl acl-987ae99ba6da32008839067c993ad497 var('txn.http_harden_excluded'),bool -m bool
    acl acl-f8de46cff6c1207cdcc8beacca736001 var('txn.http_ranges_allowed'),bool -m bool
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'GET'
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'HEAD'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'POST'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request auth realm 'example.com' if !acl-9e7f02c411b61b73a994c13f5425ff34
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-e8d600e60373785655b4658e9892e40e acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "User-Agent" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Referer" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Encoding" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Language" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Charset" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Authorization" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001
    http-request del-header "If-Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001

    #---- HTTP Response Rules
    http-response deny if !acl-a826330dc6dcbe55c697edbaf2545179 acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-a5ce4c4d95c7c2b129ce65034af2ce3b !acl-f60b83decee1e372ae573669776d5e7a acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-129daa7ff8911a10a9f9372f07d30810 !acl-5d60910ffcf3e7a6e2ce9526542fda3a acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Frame-Options" "SAMEORIGIN" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Feature-Policy" "accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; camera 'none'; display-capture 'none'; document-domain 'none'; encrypted-media 'none'; fullscreen 'none'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-get 'none'; sync-xhr 'none'; usb 'none'; xr-spatial-tracking 'none'" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Cross-Origin-Opener-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Resource-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Embedder-Policy" "unsafe-none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Via" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Server" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "X-Powered-By" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Accept-Ranges" "none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac !acl-f8de46cff6c1207cdcc8beacca736001
    http-response set-header "Strict-Transport-Security" "max-age=126144000" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9091' check observe layer7




backend 'http-static'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none
    option abortonclose

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- Servers
    default-server init-addr none

    #---- ACL
    acl acl-e8d600e60373785655b4658e9892e40e method,upper -m str -i eq -- 'GET'
    acl acl-8efd2993b14d7316ac2f903fed7bb3ac res.fhdr_cnt('X-HA-Hardened'),bool,not -m bool
    acl acl-ec8d3469dfa9bd7a78ae9d96b66b64df ssl_fc -m bool
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 200
    acl acl-d1e6c212da84dd734cf2c78fadc3de41 status -m int eq -- 200
    acl acl-e9460388e306723c9ca38e5be35ca47c status -m int eq -- 200
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 201
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 202
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 204
    acl acl-d1e6c212da84dd734cf2c78fadc3de41 status -m int eq -- 204
    acl acl-d1e6c212da84dd734cf2c78fadc3de41 status -m int eq -- 304
    acl acl-e9460388e306723c9ca38e5be35ca47c status -m int eq -- 304
    acl acl-766136fb89c18a529ae828035871887d var('txn.http_harden_enabled'),bool -m bool
    acl acl-987ae99ba6da32008839067c993ad497 var('txn.http_harden_excluded'),bool -m bool
    acl acl-f8de46cff6c1207cdcc8beacca736001 var('txn.http_ranges_allowed'),bool -m bool
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'GET'
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'HEAD'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'POST'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-e8d600e60373785655b4658e9892e40e acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "User-Agent" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Referer" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Encoding" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Language" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Charset" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Authorization" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001
    http-request del-header "If-Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001

    #---- HTTP Response Rules
    http-response deny if !acl-d1e6c212da84dd734cf2c78fadc3de41 acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-a5ce4c4d95c7c2b129ce65034af2ce3b !acl-e9460388e306723c9ca38e5be35ca47c acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-129daa7ff8911a10a9f9372f07d30810 !acl-3184fd3209feafbf4ee39f65a0ef6a94 acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Frame-Options" "SAMEORIGIN" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Feature-Policy" "accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; camera 'none'; display-capture 'none'; document-domain 'none'; encrypted-media 'none'; fullscreen 'none'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-get 'none'; sync-xhr 'none'; usb 'none'; xr-spatial-tracking 'none'" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Cross-Origin-Opener-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Resource-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Embedder-Policy" "unsafe-none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Via" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Server" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "X-Powered-By" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Accept-Ranges" "none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac !acl-f8de46cff6c1207cdcc8beacca736001
    http-response set-header "Strict-Transport-Security" "max-age=504576000" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9092' check observe layer7




backend 'http-media'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none
    option abortonclose

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- Servers
    default-server init-addr none

    #---- ACL
    acl acl-e8d600e60373785655b4658e9892e40e method,upper -m str -i eq -- 'GET'
    acl acl-8efd2993b14d7316ac2f903fed7bb3ac res.fhdr_cnt('X-HA-Hardened'),bool,not -m bool
    acl acl-ec8d3469dfa9bd7a78ae9d96b66b64df ssl_fc -m bool
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 200
    acl acl-d1e6c212da84dd734cf2c78fadc3de41 status -m int eq -- 200
    acl acl-e9460388e306723c9ca38e5be35ca47c status -m int eq -- 200
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 201
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 202
    acl acl-3184fd3209feafbf4ee39f65a0ef6a94 status -m int eq -- 204
    acl acl-d1e6c212da84dd734cf2c78fadc3de41 status -m int eq -- 204
    acl acl-d1e6c212da84dd734cf2c78fadc3de41 status -m int eq -- 304
    acl acl-e9460388e306723c9ca38e5be35ca47c status -m int eq -- 304
    acl acl-766136fb89c18a529ae828035871887d var('txn.http_harden_enabled'),bool -m bool
    acl acl-987ae99ba6da32008839067c993ad497 var('txn.http_harden_excluded'),bool -m bool
    acl acl-f8de46cff6c1207cdcc8beacca736001 var('txn.http_ranges_allowed'),bool -m bool
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'GET'
    acl acl-a5ce4c4d95c7c2b129ce65034af2ce3b var('txn.logging_http_method') -m str eq -- 'HEAD'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'POST'
    acl acl-129daa7ff8911a10a9f9372f07d30810 var('txn.logging_http_method') -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-e8d600e60373785655b4658e9892e40e acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "User-Agent" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Referer" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Encoding" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Language" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Accept-Charset" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Authorization" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497
    http-request del-header "Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001
    http-request del-header "If-Range" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 !acl-f8de46cff6c1207cdcc8beacca736001

    #---- HTTP Response Rules
    http-response deny if !acl-d1e6c212da84dd734cf2c78fadc3de41 acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-a5ce4c4d95c7c2b129ce65034af2ce3b !acl-e9460388e306723c9ca38e5be35ca47c acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response deny if acl-129daa7ff8911a10a9f9372f07d30810 !acl-3184fd3209feafbf4ee39f65a0ef6a94 acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Frame-Options" "SAMEORIGIN" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Feature-Policy" "accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; camera 'none'; display-capture 'none'; document-domain 'none'; encrypted-media 'none'; fullscreen 'none'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; payment 'none'; picture-in-picture 'none'; publickey-credentials-get 'none'; sync-xhr 'none'; usb 'none'; xr-spatial-tracking 'none'" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df
    http-response set-header "Cross-Origin-Opener-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Resource-Policy" "same-origin" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Cross-Origin-Embedder-Policy" "unsafe-none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Via" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "Server" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response del-header "X-Powered-By" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac
    http-response set-header "Accept-Ranges" "none" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac !acl-f8de46cff6c1207cdcc8beacca736001
    http-response set-header "Strict-Transport-Security" "max-age=504576000" if acl-766136fb89c18a529ae828035871887d !acl-987ae99ba6da32008839067c993ad497 acl-8efd2993b14d7316ac2f903fed7bb3ac acl-ec8d3469dfa9bd7a78ae9d96b66b64df

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9093' check observe layer7




backend 'http-fallback'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option httpclose
    option forwardfor header X-Forwarded-For if-none
    option abortonclose

    #---- Servers
    default-server init-addr none

    #---- HTTP Request Rules
    http-request deny deny_status 403








userlist 'operators'

    #---- Users
    user 'operator' insecure-password 'zeregigojacuyixu'

