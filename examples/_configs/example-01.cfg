
global

    #---- Identity
    node 'haproxy.example.com'
    description '[]'

    #---- Daemon
    nbthread 1
    ulimit-n 65536
    user 'haproxy'
    group 'haproxy'
    pidfile '/run/haproxy.pid'

    #---- State
    server-state-base '/run/haproxy-state--'
    server-state-file '/run/haproxy.state'

    #---- Connections
    maxconn 8192
    maxconnrate 512
    maxsessrate 2048
    maxsslconn 4096
    maxsslrate 256
    maxpipes 4096

    #---- Checks
    max-spread-checks 6
    spread-checks 25

    #---- HTTP
    tune.http.logurilen 4096
    tune.http.maxhdr 64

    #---- HTTP/2
    tune.h2.header-table-size 16384
    tune.h2.initial-window-size 131072
    tune.h2.max-concurrent-streams 128

    #---- Compression
    maxcomprate 0
    maxcompcpuusage 25
    maxzlibmem 128
    tune.comp.maxlevel 9

    #---- Buffers
    tune.bufsize 131072
    tune.buffers.limit 4096
    tune.buffers.reserve 16
    tune.maxrewrite 16384

    #---- TLS default configuration
    ssl-default-bind-ciphers 'ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES256-SHA256:AES128-GCM-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA'
    ssl-default-bind-options no-sslv3 no-tls-tickets
    ssl-default-server-ciphers 'ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES256-SHA256:AES128-GCM-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA'
    ssl-default-server-options no-sslv3 no-tls-tickets
    ssl-server-verify required
    ssl-dh-param-file '/etc/haproxy/tls/dh-params.pem'

    #---- TLS advanced configuration
    tune.ssl.default-dh-param 2048
    tune.ssl.maxrecord 16384
    tune.ssl.cachesize 131072
    tune.ssl.lifetime 3600s

    #---- Logging
    log '/dev/log' len 65535 format 'rfc5424' daemon info err
    log-send-hostname 'haproxy.example.com'
    log-tag 'haproxy'
    quiet

    #---- Statistics
    stats socket '/run/haproxy.sock' user 'haproxy' group 'haproxy' mode 0600 level admin
    stats maxconn 4
    stats timeout 60s








defaults

    #---- Protocol
    mode tcp
    disabled

    #---- Connections
    maxconn 4096
    backlog 1024
    rate-limit sessions 16384
    balance roundrobin
    retries 4

    #---- Connections TCP-Keep-Alive
    option clitcpka
    option srvtcpka

    #---- Connections splicing
    option splice-request
    option splice-response
    no option splice-auto

    #---- Timeouts
    timeout server 60s
    timeout server-fin 6s
    timeout client 30s
    timeout client-fin 6s
    timeout tunnel 180s
    timeout connect 6s
    timeout queue 30s
    timeout check 6s
    timeout tarpit 30s

    #---- Servers
    fullconn 16
    default-server minconn 8
    default-server maxconn 32
    default-server maxqueue 128
    default-server inter 60s
    default-server fastinter 2s
    default-server downinter 20s
    default-server rise 8
    default-server fall 4
    default-server on-error fastinter
    default-server error-limit 4

    #---- HTTP
    http-reuse safe
    http-check disable-on-404
    http-check send-state
    option http-keep-alive
    timeout http-request 30s
    timeout http-keep-alive 60s
    unique-id-format "%[req.hdr(X-HA-Request-Id)]"
    unique-id-header 'X-HA-Request-Id-2'

    #---- HTTP compression
    compression algo gzip
    compression type 'text/html' 'text/css' 'application/javascript' 'text/javascript' 'application/xml' 'text/xml' 'application/xhtml+xml' 'application/rss+xml' 'application/atom+xml' 'application/json' 'text/json' 'text/plain' 'text/csv' 'text/tab-separated-values' 'image/svg+xml' 'image/vnd.microsoft.icon' 'image/x-icon' 'font/collection' 'font/otf' 'application/font-otf' 'application/x-font-otf' 'application/x-font-opentype' 'font/ttf' 'application/font-ttf' 'application/x-font-ttf' 'application/x-font-truetype' 'font/sfnt' 'application/font-sfnt' 'application/x-font-sfnt' 'font/woff' 'application/font-woff' 'application/x-font-woff' 'font/woff2' 'application/font-woff2' 'application/x-font-woff2' 'font/eot' 'application/font-eot' 'application/x-font-eot' 'application/vnd.ms-fontobject'

    #---- Logging
    log global
    option log-separate-errors
    option log-health-checks
    no option checkcache
    no option dontlognull

    #---- Stats
    option contstats
    option socket-stats

    #---- Error pages
    errorfile 200 '/etc/haproxy/errors/http/monitor.http'
    errorfile 400 '/etc/haproxy/errors/http/400.http'
    errorfile 401 '/etc/haproxy/errors/http/401.http'
    errorfile 403 '/etc/haproxy/errors/http/403.http'
    errorfile 404 '/etc/haproxy/errors/http/404.http'
    errorfile 405 '/etc/haproxy/errors/http/405.http'
    errorfile 408 '/etc/haproxy/errors/http/408.http'
    errorfile 429 '/etc/haproxy/errors/http/429.http'
    errorfile 500 '/etc/haproxy/errors/http/500.http'
    errorfile 502 '/etc/haproxy/errors/http/502.http'
    errorfile 503 '/etc/haproxy/errors/http/503.http'
    errorfile 504 '/etc/haproxy/errors/http/504.http'

    #---- State
    load-server-state-from-file global








frontend 'http'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    maxconn 4096
    backlog 1024
    option http-keep-alive

    #---- Compression
    compression algo gzip
    compression type 'text/html' 'text/css' 'application/javascript' 'text/javascript' 'application/xml' 'text/xml' 'application/xhtml+xml' 'application/rss+xml' 'application/atom+xml' 'application/json' 'text/json' 'text/plain' 'text/csv' 'text/tab-separated-values' 'image/svg+xml' 'image/vnd.microsoft.icon' 'image/x-icon' 'font/collection' 'font/otf' 'application/font-otf' 'application/x-font-otf' 'application/x-font-opentype' 'font/ttf' 'application/font-ttf' 'application/x-font-ttf' 'application/x-font-truetype' 'font/sfnt' 'application/font-sfnt' 'application/x-font-sfnt' 'font/woff' 'application/font-woff' 'application/x-font-woff' 'font/woff2' 'application/font-woff2' 'application/x-font-woff2' 'font/eot' 'application/font-eot' 'application/x-font-eot' 'application/vnd.ms-fontobject'
    compression offload

    #---- Bind
    bind 'ipv4@0.0.0.0:80' defer-accept mss 1400 maxconn 4096 backlog 1024

    #---- ACL
    acl acl-a3058abe2beaa32f23aa0859d9353d58 path() -m beg -- '/admin/'
    acl acl-dc99acf2cd5ca02d063ee50dd805c95c path() -m str eq -- '/__/heartbeat-haproxy'
    acl acl-db6f07c94ee73130dd2d31238086e742 query() -m found
    acl acl-97e93fb6b836f8fe354245d61db52f04 req.fhdr(Host,-1),lower -m str -i eq -- 'admin.example.com'
    acl acl-e69da328e74d679abdb47fb3ecd3f999 req.fhdr(Host,-1),lower -m str -i eq -- 'admin.example.com'
    acl acl-68c37559973bfe0a68f20ef95e0cba8a req.fhdr(Host,-1),lower -m str -i eq -- 'blog.example.com'
    acl acl-fbf93f736aab81b3dcc9caf57c3abc84 req.fhdr(Host,-1),lower -m str -i eq -- 'example.com'
    acl acl-2a6fe4dec269c2ba4b77b1e38f6eb94e req.fhdr(Host,-1),lower -m str -i eq -- 'media.example.com'
    acl acl-921637c27ec24ad125d372fa8e45b7c5 req.fhdr(Host,-1),lower -m str -i eq -- 'www.example.com'
    acl acl-e69da328e74d679abdb47fb3ecd3f999 req.fhdr(Host,-1),lower -m str -i eq -- 'www.example.com'
    acl acl-dbaf316a86669df8911f5b91102e8aa0 ssl_fc() -m bool
    acl acl-402db81baae469d338b6468436716b6b ssl_fc(),not -m bool

    #---- Stick tables
    stick-table type ip size 1048576 expire 3600s store conn_cur,conn_cnt,conn_rate(60s),sess_cnt,sess_rate(60s),http_req_cnt,http_req_rate(60s),http_err_cnt,http_err_rate(60s),bytes_in_cnt,bytes_in_rate(60s),bytes_out_cnt,bytes_out_rate(60s)
    http-request track-sc0 src

    #---- HTTP Request Rules
    http-request deny deny_status 200 if acl-dc99acf2cd5ca02d063ee50dd805c95c
    http-request set-header "X-Forwarded-Host" "%[req.fhdr(Host,-1),lower]"
    http-request set-header "X-Forwarded-For" "%ci"
    http-request set-header "X-Forwarded-Proto" "http" if acl-402db81baae469d338b6468436716b6b
    http-request set-header "X-Forwarded-Proto" "https" if acl-dbaf316a86669df8911f5b91102e8aa0
    http-request set-header "X-Forwarded-Port" "80" if acl-402db81baae469d338b6468436716b6b
    http-request set-header "X-Forwarded-Port" "443" if acl-dbaf316a86669df8911f5b91102e8aa0
    http-request set-header "X-Forwarded-Server-Ip" "%fi"
    http-request set-header "X-Forwarded-Server-Port" "%fp"
    http-request set-header "X-HA-HTTP-Action" "%[method(),upper]://%[req.fhdr(Host,-1),lower]%[path()]" if !acl-db6f07c94ee73130dd2d31238086e742
    http-request set-header "X-HA-HTTP-Action" "%[method(),upper]://%[req.fhdr(Host,-1),lower]%[path()]?%[query()]" if acl-db6f07c94ee73130dd2d31238086e742
    http-request set-var(txn.logging_http_action) req.fhdr(X-HA-HTTP-Action,-1)
    http-request set-var(txn.logging_http_method) method(),upper
    http-request set-var(txn.logging_http_host) req.fhdr(Host,-1),lower
    http-request set-var(txn.logging_http_path) path()
    http-request set-var(txn.logging_http_query) query()
    http-request set-var(txn.logging_http_forwarded_host) req.hdr(X-Forwarded-Host,1)
    http-request set-var(txn.logging_http_forwarded_for) req.hdr(X-Forwarded-For,1)
    http-request set-var(txn.logging_http_forwarded_proto) req.hdr(X-Forwarded-Proto,1)
    http-request set-var(txn.logging_http_request) req.fhdr(X-HA-Request-Id,-1)
    http-request set-var(txn.logging_http_session) req.fhdr(X-HA-Session-Id,-1)
    http-request set-var(txn.logging_http_agent) req.fhdr(User-Agent,-1)
    http-request set-var(txn.logging_http_referrer) req.fhdr(Referer,-1)
    http-request capture req.fhdr(Host,-1),base64 id 0
    http-request capture req.fhdr(X-Forwarded-Host,-1),base64 id 1
    http-request capture req.fhdr(X-Forwarded-For,-1),base64 id 2
    http-request capture req.fhdr(X-Forwarded-Proto,-1),base64 id 3
    http-request capture req.fhdr(X-Forwarded-Port,-1),base64 id 4
    http-request capture req.fhdr(X-HA-Request-Id,-1),base64 id 5
    http-request capture req.fhdr(X-HA-Session-Id,-1),base64 id 6
    http-request capture req.fhdr(User-Agent,-1),base64 id 7
    http-request capture req.fhdr(Referer,-1),base64 id 8
    http-request capture req.fhdr(Accept-Encoding,-1),base64 id 9
    http-request capture req.fhdr(Accept-Language,-1),base64 id 10
    http-request capture req.fhdr(Accept-Charset,-1),base64 id 11
    http-request capture req.fhdr(Cache-Control,-1),base64 id 12
    http-request capture req.fhdr(If-None-Match,-1),base64 id 13
    http-request capture req.fhdr(If-Match,-1),base64 id 14
    http-request capture req.fhdr(If-Modified-Since,-1),base64 id 15
    http-request capture req.fhdr(If-Unmodified-Since,-1),base64 id 16
    http-request capture req.fhdr(Pragma,-1),base64 id 17
    http-request capture req.fhdr(Cookie,1),base64 id 18
    http-request capture req.fhdr(Cookie,2),base64 id 19
    http-request capture req.fhdr(Cookie,3),base64 id 20
    http-request capture req.fhdr(Cookie,4),base64 id 21
    http-request set-header "X-HA-HTTP-Action" "%[var(txn.logging_http_action)]"
    http-request set-header "X-HA-Timestamp" "%[date(),http_date()]"
    http-request add-header "X-HA-Frontend" "%f"
    http-request add-header "X-HA-Backend" "%b"
    http-request redirect scheme https code 307 if acl-402db81baae469d338b6468436716b6b
    http-request redirect prefix "https://www.example.com" code 307 if acl-fbf93f736aab81b3dcc9caf57c3abc84 acl-402db81baae469d338b6468436716b6b
    http-request redirect prefix "https://www.example.com" code 307 if acl-fbf93f736aab81b3dcc9caf57c3abc84 acl-dbaf316a86669df8911f5b91102e8aa0
    http-request redirect prefix "https://www.example.com/blog" code 307 if acl-68c37559973bfe0a68f20ef95e0cba8a
    http-request redirect prefix "https://admin.example.com" code 307 if acl-921637c27ec24ad125d372fa8e45b7c5 acl-a3058abe2beaa32f23aa0859d9353d58

    #---- HTTP Response Rules
    http-response set-var(txn.logging_http_location) res.fhdr(Location,-1)
    http-response set-var(txn.logging_http_content_type) res.fhdr(Content-Type,-1)
    http-response set-var(txn.logging_http_content_encoding) res.fhdr(Content-Encoding,-1)
    http-response set-var(txn.logging_http_content_length) res.fhdr(Content-Length,-1)
    http-response set-var(txn.logging_http_cache_control) res.fhdr(Cache-Control,-1)
    http-response set-var(txn.logging_http_cache_etag) res.fhdr(ETag,-1)
    http-response capture res.fhdr(Location,-1),base64 id 0
    http-response capture res.fhdr(Content-Type,-1),base64 id 1
    http-response capture res.fhdr(Content-Encoding,-1),base64 id 2
    http-response capture res.fhdr(Content-Length,-1),base64 id 3
    http-response capture res.fhdr(Content-Disposition,-1),base64 id 4
    http-response capture res.fhdr(Cache-Control,-1),base64 id 5
    http-response capture res.fhdr(Last-Modified,-1),base64 id 6
    http-response capture res.fhdr(Expires,-1),base64 id 7
    http-response capture res.fhdr(Date,-1),base64 id 8
    http-response capture res.fhdr(ETag,-1),base64 id 9
    http-response capture res.fhdr(Vary,-1),base64 id 10
    http-response capture res.fhdr(Age,-1),base64 id 11
    http-response capture res.fhdr(Pragma,-1),base64 id 12
    http-response capture res.fhdr(Set-Cookie,1),base64 id 13
    http-response capture res.fhdr(Set-Cookie,2),base64 id 14
    http-response capture res.fhdr(Set-Cookie,3),base64 id 15
    http-response capture res.fhdr(Set-Cookie,4),base64 id 16
    http-response set-header "X-HA-HTTP-Action" "%[var(txn.logging_http_action)]"
    http-response set-header "X-HA-Timestamp" "%[date(),http_date()]"
    http-response add-header "X-HA-Frontend" "%f"
    http-response add-header "X-HA-Backend" "%b"

    #---- Routes
    use_backend http-www if acl-921637c27ec24ad125d372fa8e45b7c5
    use_backend http-admin if acl-97e93fb6b836f8fe354245d61db52f04
    use_backend http-static if acl-e69da328e74d679abdb47fb3ecd3f999 /assets/ /public/
    use_backend http-media if acl-2a6fe4dec269c2ba4b77b1e38f6eb94e
    use_backend http-fallback

    #---- Monitoring
    monitor-uri '/__/heartbeat-proxy'
    monitor fail if FALSE

    #---- Stats
    stats enable
    stats uri '/__/haproxy/beb36ad8a85568b7e89e314b2e03244f'
    stats realm 'haproxy@haproxy.example.com'
    stats show-node 'haproxy.example.com'
    stats show-desc '[]'
    stats show-legends
    stats refresh 6s

    #---- Logging
    option httplog
    log-format "{  \"s\":\"20190405:01\",  \"ss\":\"default\",  \"t\":%Ts.%ms,  \"f_id\":\"%{Q}f\",  \"b_id\":\"%{Q}b\",  \"s_id\":\"%{Q}s\",  \"h_v\":\"%{Q}HV\",  \"h_vm\":%[fc_http_major],  \"h_s\":%ST,  \"h_m0\":\"%{Q}HM\",  \"h_u0\":\"%{Q}HU\",  \"h_p0\":\"%{Q}HP\",  \"h_q0\":\"%{Q}HQ\",  \"h_r_t\":\"%{Q}trg\",  \"h_r_i\":\"%{Q}ID\",  \"h_h\":\"%[var(txn.logging_http_host),json()]\",  \"h_m\":\"%[var(txn.logging_http_method),json()]\",  \"h_p\":\"%[var(txn.logging_http_path),json()]\",  \"h_q\":\"%[var(txn.logging_http_query),json()]\",  \"h_f_h\":\"%[var(txn.logging_http_forwarded_host),json()]\",  \"h_f_f\":\"%[var(txn.logging_http_forwarded_for),json()]\",  \"h_f_p\":\"%[var(txn.logging_http_forwarded_proto),json()]\",  \"h_r_s\":\"%[var(txn.logging_http_session),json()]\",  \"h_h_a\":\"%[var(txn.logging_http_agent),json()]\",  \"h_h_r\":\"%[var(txn.logging_http_referrer),json()]\",  \"h_h_l\":\"%[var(txn.logging_http_location),json()]\",  \"h_h_ct\":\"%[var(txn.logging_http_content_type),json()]\",  \"h_h_ce\":\"%[var(txn.logging_http_content_encoding),json()]\",  \"h_h_cl\":\"%[var(txn.logging_http_content_length),json()]\",  \"h_h_cc\":\"%[var(txn.logging_http_cache_control),json()]\",  \"h_h_cv\":\"%[var(txn.logging_http_cache_etag),json()]\",  \"h_i_hdr\":\"%{Q}hrl\",  \"h_o_hdr\":\"%{Q}hsl\",  \"h_i_ck\":\"%{Q}CC\",  \"h_o_ck\":\"%{Q}CS\",  \"h_o_comp\":[%[res.comp],\"%[res.comp_algo]\"],  \"c_sck\":[\"%{Q}ci\",\"%{Q}cp\"],  \"f_sck\":[\"%{Q}fi\",\"%{Q}fp\"],  \"b_sck\":[\"%{Q}bi\",\"%{Q}bp\"],  \"s_sck\":[\"%{Q}si\",\"%{Q}sp\"],  \"i_sz\":%U,  \"o_sz\":%B,  \"w\":[%Tt,%Tq,%Ta],  \"w_x\":[%Th,%Ti,%TR,%Tw,%Tc,%Tr,%Td],  \"f_ld\":[%ac,%fc,%bc,%bq,%sc,%sq,%rc],  \"f_st\":\"%{Q}tsc\",  \"g_cnt\":[%lc,%rt],  \"ssl\":[\"%{Q}sslv\",\"%{Q}sslc\"],  \"ssl_x\":[%[ssl_fc],\"%[ssl_fc_protocol,json()]\",\"%[ssl_fc_cipher,json()]\",\"%[ssl_fc_unique_id,hex]\",\"%[ssl_fc_session_id,hex]\",%[ssl_fc_is_resumed],%[ssl_fc_has_sni],\"%[ssl_fc_sni,json()]\",\"%[ssl_fc_alpn,json()]\",\"%[ssl_fc_npn,json()]\"],  \"ssl_xf\":[%[ssl_fc],\"%[ssl_f_version,json()]\",\"%[ssl_f_sha1,hex]\",\"%[ssl_f_s_dn,json()]\"],  \"ssl_xc\":[\"%[ssl_c_used]\",\"%[ssl_c_version,json()]\",\"%[ssl_c_sha1,hex]\",\"%[ssl_c_verify,json()]\",\"%[ssl_c_err,json()]\",\"%[ssl_c_ca_err,json()]\",\"%[ssl_c_ca_err_depth,json()]\",\"%[ssl_c_s_dn,json()]\",\"%[ssl_c_i_dn,json()]\"],  \"stick\":[\"%[sc0_conn_cur()]\",\"%[sc0_conn_cnt()]\",\"%[sc0_conn_rate()]\",\"%[sc0_sess_cnt()]\",\"%[sc0_sess_rate()]\",\"%[sc0_http_req_cnt()]\",\"%[sc0_http_req_rate()]\",\"%[sc0_http_err_cnt()]\",\"%[sc0_http_err_rate()]\",\"%[sc0_kbytes_in()]\",\"%[sc0_bytes_in_rate()]\",\"%[sc0_kbytes_out()]\",\"%[sc0_bytes_out_rate()]\"]  }"

    #---- Captures for requests
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024
    declare capture request len 1024

    #---- Captures for responses
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024
    declare capture response len 1024








backend 'http-www'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- ACL
    acl acl-31cd988175a00e62d1f0caeb898edffc method(),upper -m str -i eq -- 'GET'
    acl acl-31cd988175a00e62d1f0caeb898edffc method(),upper -m str -i eq -- 'HEAD'
    acl acl-31cd988175a00e62d1f0caeb898edffc method(),upper -m str -i eq -- 'OPTIONS'
    acl acl-3c59ba7ade2dcbc97e255bc84df26138 res.fhdr_cnt(Content-Security-Policy),bool,not -m bool
    acl acl-cddb74ede2b7512d5b96adfe9ff24ed8 res.fhdr_cnt(Referrer-Policy),bool,not -m bool
    acl acl-faa30fb5169c5cb362e92e34e8d95c63 res.fhdr_cnt(X-Content-Type-Options),bool,not -m bool
    acl acl-383bb05696e26074552dcad3578941d2 res.fhdr_cnt(X-Frame-Options),bool,not -m bool
    acl acl-5e71e7a5a9c85cddb64ac939d6b01b5b res.fhdr_cnt(X-HA-Hardened),bool,not -m bool
    acl acl-330d417e8d275a75dd6b51c427bc76ad res.fhdr_cnt(X-XSS-Protection),bool,not -m bool
    acl acl-dbaf316a86669df8911f5b91102e8aa0 ssl_fc() -m bool
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 200
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 200
    acl acl-8bb065a40a5f02a28e7eb3985c6f4b83 status() -m int eq -- 200
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 201
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 201
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 202
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 202
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 204
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 204
    acl acl-8bb065a40a5f02a28e7eb3985c6f4b83 status() -m int eq -- 204
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 206
    acl acl-8bb065a40a5f02a28e7eb3985c6f4b83 status() -m int eq -- 206
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 301
    acl acl-8bb065a40a5f02a28e7eb3985c6f4b83 status() -m int eq -- 301
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 302
    acl acl-8bb065a40a5f02a28e7eb3985c6f4b83 status() -m int eq -- 302
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 303
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 303
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 304
    acl acl-8bb065a40a5f02a28e7eb3985c6f4b83 status() -m int eq -- 304
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 307
    acl acl-0b6514ac5074944c7b503fe905318c7e status() -m int eq -- 308
    acl acl-c64546c578fa8230ee5d39ac4b7c2712 var(txn.http_drop_cookies_enabled),bool -m bool
    acl acl-af72d758a9bab46b72adfa8addaa9eec var(txn.http_drop_cookies_excluded),bool -m bool
    acl acl-ea8904884d5ca0ea679332ade0e2c2d7 var(txn.http_force_caching_enabled),bool -m bool
    acl acl-8f3970dece21e08e07c95b1baa8c8e85 var(txn.http_force_caching_excluded),bool -m bool
    acl acl-85fb5d45e2e95e08c3d894f8de6ced12 var(txn.http_harden_enabled),bool -m bool
    acl acl-b85e6a2d677541d35125f328f649d759 var(txn.http_harden_excluded),bool -m bool
    acl acl-68f4c7006072abd497e50fa192174d47 var(txn.http_ranges_allowed),bool -m bool
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'GET'
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'HEAD'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'POST'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-31cd988175a00e62d1f0caeb898edffc acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "User-Agent" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Referer" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Encoding" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Language" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Charset" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Authorization" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47
    http-request del-header "If-Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47
    http-request set-var(txn.http_drop_cookies_enabled) bool(true)
    http-request del-header "Cookie" if acl-c64546c578fa8230ee5d39ac4b7c2712 !acl-af72d758a9bab46b72adfa8addaa9eec
    http-request set-var(txn.http_force_caching_enabled) bool(true)
    http-request set-var(txn.http_drop_cookies_enabled) bool(true)
    http-request del-header "Cookie" if acl-c64546c578fa8230ee5d39ac4b7c2712 !acl-af72d758a9bab46b72adfa8addaa9eec
    http-request set-var(txn.http_force_caching_enabled) bool(true)
    http-request set-var(txn.http_drop_cookies_enabled) bool(true)
    http-request del-header "Cookie" if acl-c64546c578fa8230ee5d39ac4b7c2712 !acl-af72d758a9bab46b72adfa8addaa9eec
    http-request set-var(txn.http_force_caching_enabled) bool(true)

    #---- HTTP Response Rules
    http-response deny if !acl-0b6514ac5074944c7b503fe905318c7e acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-bc37030288a794d84b811df7e8f74e47 !acl-8bb065a40a5f02a28e7eb3985c6f4b83 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-b8806224a08ed89805184c07ff944ea7 !acl-670a5ce47ddd9dda98965137c1b1808c acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0 acl-3c59ba7ade2dcbc97e255bc84df26138
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-cddb74ede2b7512d5b96adfe9ff24ed8
    http-response set-header "X-Frame-Options" "sameorigin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-383bb05696e26074552dcad3578941d2
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-faa30fb5169c5cb362e92e34e8d95c63
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-330d417e8d275a75dd6b51c427bc76ad
    http-response del-header "Via" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "Server" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "X-Powered-By" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Accept-Ranges" "none" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b !acl-68f4c7006072abd497e50fa192174d47
    http-response set-header "Strict-Transport-Security" "max-age=2419200" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0
    http-response del-header "Set-Cookie" if acl-c64546c578fa8230ee5d39ac4b7c2712 !acl-af72d758a9bab46b72adfa8addaa9eec
    http-response set-header "Cache-Control" "public, immutable, max-age=3600" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Last-Modified" "%[date(-3600),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Expires" "%[date(3600),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Date" "%[date(),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Age" "0" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Pragma" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "ETag" "\"%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]\"" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Set-Cookie" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Set-Cookie" if acl-c64546c578fa8230ee5d39ac4b7c2712 !acl-af72d758a9bab46b72adfa8addaa9eec
    http-response set-header "Cache-Control" "public, immutable, max-age=3600" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Last-Modified" "%[date(-3600),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Expires" "%[date(3600),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Date" "%[date(),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Age" "0" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Pragma" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "ETag" "\"%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]\"" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Set-Cookie" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Set-Cookie" if acl-c64546c578fa8230ee5d39ac4b7c2712 !acl-af72d758a9bab46b72adfa8addaa9eec
    http-response set-header "Cache-Control" "public, immutable, max-age=3600" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Last-Modified" "%[date(-3600),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Expires" "%[date(3600),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Date" "%[date(),http_date()]" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "Age" "0" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Pragma" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response set-header "ETag" "\"%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]%[rand(4294967295),bytes(4,4),hex,lower]\"" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85
    http-response del-header "Set-Cookie" if acl-ea8904884d5ca0ea679332ade0e2c2d7 !acl-8f3970dece21e08e07c95b1baa8c8e85

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9090' check observe layer7




backend 'http-admin'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- ACL
    acl acl-612f2043bdbd6cb5daf89bb3c9339d5e http_auth(operators),bool -m bool
    acl acl-d244e23f3e50cc6182e450d7e6551deb method(),upper -m str -i eq -- 'GET'
    acl acl-3c59ba7ade2dcbc97e255bc84df26138 res.fhdr_cnt(Content-Security-Policy),bool,not -m bool
    acl acl-cddb74ede2b7512d5b96adfe9ff24ed8 res.fhdr_cnt(Referrer-Policy),bool,not -m bool
    acl acl-faa30fb5169c5cb362e92e34e8d95c63 res.fhdr_cnt(X-Content-Type-Options),bool,not -m bool
    acl acl-383bb05696e26074552dcad3578941d2 res.fhdr_cnt(X-Frame-Options),bool,not -m bool
    acl acl-5e71e7a5a9c85cddb64ac939d6b01b5b res.fhdr_cnt(X-HA-Hardened),bool,not -m bool
    acl acl-330d417e8d275a75dd6b51c427bc76ad res.fhdr_cnt(X-XSS-Protection),bool,not -m bool
    acl acl-dbaf316a86669df8911f5b91102e8aa0 ssl_fc() -m bool
    acl acl-02be61dbc89a374569fa6ee7517b2157 status() -m int eq -- 200
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 200
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 200
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 201
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 202
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 204
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 204
    acl acl-02be61dbc89a374569fa6ee7517b2157 status() -m int eq -- 301
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 301
    acl acl-02be61dbc89a374569fa6ee7517b2157 status() -m int eq -- 302
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 302
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 303
    acl acl-670a5ce47ddd9dda98965137c1b1808c status() -m int eq -- 303
    acl acl-02be61dbc89a374569fa6ee7517b2157 status() -m int eq -- 304
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 304
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 307
    acl acl-5156311775e89d15ec3a1c0358d76231 status() -m int eq -- 308
    acl acl-85fb5d45e2e95e08c3d894f8de6ced12 var(txn.http_harden_enabled),bool -m bool
    acl acl-b85e6a2d677541d35125f328f649d759 var(txn.http_harden_excluded),bool -m bool
    acl acl-68f4c7006072abd497e50fa192174d47 var(txn.http_ranges_allowed),bool -m bool
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'GET'
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'HEAD'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'POST'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request auth realm 'example.com' if !acl-612f2043bdbd6cb5daf89bb3c9339d5e
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-d244e23f3e50cc6182e450d7e6551deb acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "User-Agent" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Referer" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Encoding" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Language" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Charset" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Authorization" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47
    http-request del-header "If-Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47

    #---- HTTP Response Rules
    http-response deny if !acl-5156311775e89d15ec3a1c0358d76231 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-bc37030288a794d84b811df7e8f74e47 !acl-02be61dbc89a374569fa6ee7517b2157 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-b8806224a08ed89805184c07ff944ea7 !acl-670a5ce47ddd9dda98965137c1b1808c acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0 acl-3c59ba7ade2dcbc97e255bc84df26138
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-cddb74ede2b7512d5b96adfe9ff24ed8
    http-response set-header "X-Frame-Options" "sameorigin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-383bb05696e26074552dcad3578941d2
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-faa30fb5169c5cb362e92e34e8d95c63
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-330d417e8d275a75dd6b51c427bc76ad
    http-response del-header "Via" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "Server" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "X-Powered-By" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Accept-Ranges" "none" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b !acl-68f4c7006072abd497e50fa192174d47
    http-response set-header "Strict-Transport-Security" "max-age=126144000" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9091' check observe layer7




backend 'http-static'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- ACL
    acl acl-d244e23f3e50cc6182e450d7e6551deb method(),upper -m str -i eq -- 'GET'
    acl acl-3c59ba7ade2dcbc97e255bc84df26138 res.fhdr_cnt(Content-Security-Policy),bool,not -m bool
    acl acl-cddb74ede2b7512d5b96adfe9ff24ed8 res.fhdr_cnt(Referrer-Policy),bool,not -m bool
    acl acl-faa30fb5169c5cb362e92e34e8d95c63 res.fhdr_cnt(X-Content-Type-Options),bool,not -m bool
    acl acl-383bb05696e26074552dcad3578941d2 res.fhdr_cnt(X-Frame-Options),bool,not -m bool
    acl acl-5e71e7a5a9c85cddb64ac939d6b01b5b res.fhdr_cnt(X-HA-Hardened),bool,not -m bool
    acl acl-330d417e8d275a75dd6b51c427bc76ad res.fhdr_cnt(X-XSS-Protection),bool,not -m bool
    acl acl-dbaf316a86669df8911f5b91102e8aa0 ssl_fc() -m bool
    acl acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 status() -m int eq -- 200
    acl acl-16439216621255f1e0a66f4c49e1aa81 status() -m int eq -- 200
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 200
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 201
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 202
    acl acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 status() -m int eq -- 204
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 204
    acl acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 status() -m int eq -- 304
    acl acl-16439216621255f1e0a66f4c49e1aa81 status() -m int eq -- 304
    acl acl-85fb5d45e2e95e08c3d894f8de6ced12 var(txn.http_harden_enabled),bool -m bool
    acl acl-b85e6a2d677541d35125f328f649d759 var(txn.http_harden_excluded),bool -m bool
    acl acl-68f4c7006072abd497e50fa192174d47 var(txn.http_ranges_allowed),bool -m bool
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'GET'
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'HEAD'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'POST'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-d244e23f3e50cc6182e450d7e6551deb acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "User-Agent" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Referer" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Encoding" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Language" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Charset" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Authorization" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47
    http-request del-header "If-Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47

    #---- HTTP Response Rules
    http-response deny if !acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-bc37030288a794d84b811df7e8f74e47 !acl-16439216621255f1e0a66f4c49e1aa81 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-b8806224a08ed89805184c07ff944ea7 !acl-f34ae54cb337610afa4910c1bac7bbac acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0 acl-3c59ba7ade2dcbc97e255bc84df26138
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-cddb74ede2b7512d5b96adfe9ff24ed8
    http-response set-header "X-Frame-Options" "sameorigin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-383bb05696e26074552dcad3578941d2
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-faa30fb5169c5cb362e92e34e8d95c63
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-330d417e8d275a75dd6b51c427bc76ad
    http-response del-header "Via" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "Server" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "X-Powered-By" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Accept-Ranges" "none" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b !acl-68f4c7006072abd497e50fa192174d47
    http-response set-header "Strict-Transport-Security" "max-age=504576000" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9092' check observe layer7




backend 'http-media'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option http-server-close
    option forwardfor header X-Forwarded-For if-none

    #---- Check
    option httpchk
    http-check connect default linger
    http-check send meth 'GET' uri '/__/heartbeat' ver 'HTTP/1.1'
    http-check expect status '200'

    #---- ACL
    acl acl-d244e23f3e50cc6182e450d7e6551deb method(),upper -m str -i eq -- 'GET'
    acl acl-3c59ba7ade2dcbc97e255bc84df26138 res.fhdr_cnt(Content-Security-Policy),bool,not -m bool
    acl acl-cddb74ede2b7512d5b96adfe9ff24ed8 res.fhdr_cnt(Referrer-Policy),bool,not -m bool
    acl acl-faa30fb5169c5cb362e92e34e8d95c63 res.fhdr_cnt(X-Content-Type-Options),bool,not -m bool
    acl acl-383bb05696e26074552dcad3578941d2 res.fhdr_cnt(X-Frame-Options),bool,not -m bool
    acl acl-5e71e7a5a9c85cddb64ac939d6b01b5b res.fhdr_cnt(X-HA-Hardened),bool,not -m bool
    acl acl-330d417e8d275a75dd6b51c427bc76ad res.fhdr_cnt(X-XSS-Protection),bool,not -m bool
    acl acl-dbaf316a86669df8911f5b91102e8aa0 ssl_fc() -m bool
    acl acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 status() -m int eq -- 200
    acl acl-16439216621255f1e0a66f4c49e1aa81 status() -m int eq -- 200
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 200
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 201
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 202
    acl acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 status() -m int eq -- 204
    acl acl-f34ae54cb337610afa4910c1bac7bbac status() -m int eq -- 204
    acl acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 status() -m int eq -- 304
    acl acl-16439216621255f1e0a66f4c49e1aa81 status() -m int eq -- 304
    acl acl-85fb5d45e2e95e08c3d894f8de6ced12 var(txn.http_harden_enabled),bool -m bool
    acl acl-b85e6a2d677541d35125f328f649d759 var(txn.http_harden_excluded),bool -m bool
    acl acl-68f4c7006072abd497e50fa192174d47 var(txn.http_ranges_allowed),bool -m bool
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'GET'
    acl acl-bc37030288a794d84b811df7e8f74e47 var(txn.logging_http_method) -m str eq -- 'HEAD'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'POST'
    acl acl-b8806224a08ed89805184c07ff944ea7 var(txn.logging_http_method) -m str eq -- 'PUT'

    #---- HTTP Request Rules
    http-request set-var(txn.http_harden_enabled) bool(true)
    http-request deny if !acl-d244e23f3e50cc6182e450d7e6551deb acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "User-Agent" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Referer" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Encoding" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Language" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Accept-Charset" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Authorization" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759
    http-request del-header "Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47
    http-request del-header "If-Range" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 !acl-68f4c7006072abd497e50fa192174d47

    #---- HTTP Response Rules
    http-response deny if !acl-10ac02033e9cdf71bdaf9f7ecc6e64b1 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-bc37030288a794d84b811df7e8f74e47 !acl-16439216621255f1e0a66f4c49e1aa81 acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response deny if acl-b8806224a08ed89805184c07ff944ea7 !acl-f34ae54cb337610afa4910c1bac7bbac acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Content-Security-Policy" "upgrade-insecure-requests" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0 acl-3c59ba7ade2dcbc97e255bc84df26138
    http-response set-header "Referrer-Policy" "strict-origin-when-cross-origin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-cddb74ede2b7512d5b96adfe9ff24ed8
    http-response set-header "X-Frame-Options" "sameorigin" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-383bb05696e26074552dcad3578941d2
    http-response set-header "X-Content-Type-Options" "nosniff" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-faa30fb5169c5cb362e92e34e8d95c63
    http-response set-header "X-XSS-Protection" "1; mode=block" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-330d417e8d275a75dd6b51c427bc76ad
    http-response del-header "Via" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "Server" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response del-header "X-Powered-By" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b
    http-response set-header "Accept-Ranges" "none" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b !acl-68f4c7006072abd497e50fa192174d47
    http-response set-header "Strict-Transport-Security" "max-age=504576000" if acl-85fb5d45e2e95e08c3d894f8de6ced12 !acl-b85e6a2d677541d35125f328f649d759 acl-5e71e7a5a9c85cddb64ac939d6b01b5b acl-dbaf316a86669df8911f5b91102e8aa0

    #---- Servers
    server 'default' 'ipv4@127.0.0.1:9093' check observe layer7




backend 'http-fallback'

    #---- Protocol
    mode http
    enabled

    #---- Connections
    http-reuse never
    option httpclose
    option forwardfor header X-Forwarded-For if-none

    #---- HTTP Request Rules
    http-request deny deny_status 403








userlist 'operators'

    #---- Users
    user 'operator' insecure-password 'zeregigojacuyixu'

